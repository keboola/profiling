<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Profiling - Keboola</title>
    
    <!-- Preload critical fonts for performance -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    
    <!-- Required Dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="keboola-design-system/dist/design-system.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- REQUIRED: Base font styles -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-family-base);
            background-color: var(--neutral-grey-50);
            color: var(--neutral-grey-800);
            line-height: var(--body-body-line-height);
        }
        
        /* Activity row styles */
        .activity-row {
            padding: var(--space-2);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .activity-row:hover {
            background-color: var(--neutral-grey-100);
        }
        
        .activity-row.active {
            background-color: var(--secondary-blue-100);
        }
        
        .activity-row.active .activity-row__text {
            color: var(--secondary-blue-600);
            font-weight: 400;
        }
        
        .activity-row.active .fa-columns,
        .activity-row.active .fa-table {
            color: var(--secondary-blue-600) !important;
        }
        
        /* Control avatar size to be consistent across browsers */
        .topbar__avatar {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .topbar__avatar img {
            width: 36px;
            height: 36px;
            max-width: 36px;
            max-height: 36px;
            object-fit: cover;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-grey-50">
    <!-- Topbar Component -->
    <nav class="topbar">
        <!-- Header section with logo, project info, avatar and notifications -->
        <div class="topbar__header">
            <div class="topbar__container">
                <!-- Left section with project and context -->
                <div class="topbar__section-primary">
                    <!-- Project selector -->
                    <div class="topbar__branding">
                        <img src="keboola-design-system/assets/logos/logo_navigation.svg" alt="Keboola Logo" class="topbar__logo">
                        <div class="topbar__details">
                            <p class="topbar__subtitle">Data Team</p>
                            <p class="topbar__title">Keboola Analytics</p>
                        </div>
                        <div class="icon-container icon-small">
                            <i class="fas fa-chevron-down icon-muted"></i>
                        </div>
                    </div>
                    
                    <!-- Context selector -->
                    <div class="topbar__context">
                        <span class="topbar__context-name">Production</span>
                        <div class="icon-container icon-small">
                            <i class="fas fa-chevron-down icon-muted"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Right section with tools and user profile -->
                <div class="topbar__section-secondary">
                    <!-- Search -->
                    <div class="text-input size-medium">
                        <div class="content" style="min-height: 40px;">
                            <i class="fas fa-search" style="color: var(--neutral-grey-400);"></i>
                            <input type="text" placeholder="Search..." aria-label="Search columns and tables">
                        </div>
                    </div>
                    
                    <!-- Action Icons -->
                    <div class="topbar__actions">
                        <div class="icon-container icon-large topbar__action-item">
                            <i class="fas fa-gift icon-muted"></i>
                            <div class="topbar__indicator">5</div>
                        </div>
                        <div class="icon-container icon-large topbar__action-item">
                            <i class="fas fa-trash icon-muted"></i>
                        </div>
                    </div>
                    
                    <!-- User profile -->
                    <div class="topbar__avatar">
                        <img src="keboola-design-system/assets/avatars/placeholder.png" alt="User Avatar">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container - The topbar.css automatically adds margin-top via .topbar ~ .page-container selector -->
    <div class="container page-container" style="padding: var(--space-8) var(--space-16) var(--space-16) var(--space-16)">
        <div class="content-wrapper" style="display: flex; flex-direction: column; gap: var(--space-4)">
            <!-- Breadcrumbs moved out of header -->
            
            <!-- Header with integrated breadcrumbs -->
            <header class="header" style="height: auto; min-height: 40px;">
                <div style="display: flex; flex-direction: column;">
                    <!-- Breadcrumbs now in header -->
                    <div class="breadcrumbs" style="display: flex; align-items: center; margin-bottom: var(--space-1);">
                        <div class="breadcrumbs__item">
                            <a href="#" class="link-body" style="color: var(--neutral-grey-400);">Storage</a>
                        </div>
                        <div class="breadcrumbs__divider" style="margin: 0 var(--space-2);">
                            <i class="fas fa-chevron-right icon-muted" style="font-size: 12px; color: var(--neutral-grey-400);"></i>
                        </div>
                        <div class="breadcrumbs__item">
                            <a href="#" class="link-body" style="color: var(--neutral-grey-400);">keboola-ex-google-drive-73434</a>
                        </div>
                    </div>
                    
                    <h1 class="header__title heading-1" style="margin: 0;">
                        <i class="fas fa-table icon-muted" style="margin-right: var(--space-2);"></i>
                        Data Profiling Dashboard
                    </h1>
                </div>
                <div class="header__actions">
                    <button class="btn btn-secondary btn-medium">
                        <div class="btn-icon">
                            <i class="fas fa-download icon-muted"></i>
                        </div>
                        <span class="btn-text button-text">EXPORT REPORT</span>
                    </button>
                    <button class="btn btn-primary btn-medium">
                        <div class="btn-icon">
                            <i class="fas fa-play text-white"></i>
                        </div>
                        <span class="btn-text button-text">RE-RUN PROFILING</span>
                    </button>
                </div>
            </header>
            
            <!-- Main Navigation Tabs -->
            <div class="tabs tabs-large">
                <div class="tab-item">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Overview</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
                <div class="tab-item">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Schema</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
                <div class="tab-item active">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Profiling</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
                <div class="tab-item">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Events</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
                <div class="tab-item">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Snapshots</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
                <div class="tab-item">
                    <div class="tab-content">
                        <div class="tab-text body-text-medium">Usage</div>
                    </div>
                    <div class="tab-active-line"></div>
                </div>
            </div>
            
            <!-- Main Content with Sidebar -->
            <section class="section">
                <!-- Main Content Grid -->
                <div class="content-layout" style="display: grid; grid-template-columns: 320px 1fr; gap: var(--space-4);">
                    <!-- Left Sidebar (1/3) - Tables List -->
                    <div class="card bg-white" style="padding: var(--space-2) var(--space-4) var(--space-4) var(--space-4);">
                        <h2 class="card__title heading-4" style="margin-bottom: var(--space-1);">Table Structure</h2>
                        <div class="card__content" style="padding: 0; display: flex; flex-direction: column; gap: var(--space-2);">
                            
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <!-- Table Overview (removed section title) -->
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectTableOverview(this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-table icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">Table Overview</span>
                                    </div>
                                </div>
                                
                                <!-- Columns section title -->
                                <div style="margin: var(--space-1) 0; border-top: 1px solid var(--neutral-grey-200); padding-top: var(--space-3);">
                                    <span class="small-body-text-medium" style="color: var(--neutral-grey-800); text-transform: uppercase;">Columns</span>
                                </div>
                                
                                <!-- Search field moved below Columns divider -->
                                <div class="text-input" style="width: 100%; margin-bottom: var(--space-2);">
                                    <div class="content" style="min-height: 40px;">
                                        <i class="fas fa-search" style="color: var(--neutral-grey-400);"></i>
                                        <input type="text" placeholder="Search..." aria-label="Search columns">
                                    </div>
                                </div>
                                
                                <!-- Column items with consistent styling -->
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('user_id', 'Integer', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">user_id</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>Integer</span>
                                    </div>
                                </div>
                                
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('email', 'String', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">email</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>String</span>
                                    </div>
                                </div>
                                
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('name', 'String', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">name</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>String</span>
                                    </div>
                                </div>
                                
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('age', 'Integer', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">age</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>Integer</span>
                                    </div>
                                </div>
                                
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('signup_date', 'Date', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">signup_date</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>Date</span>
                                    </div>
                                </div>
                                
                                <div class="activity-row" style="padding: var(--space-2); border-radius: 4px; cursor: pointer;" onclick="selectColumn('status', 'Boolean', this)">
                                    <div class="activity-row__content">
                                        <div class="icon-container icon-small">
                                            <i class="fas fa-columns icon-muted"></i>
                                        </div>
                                        <span class="activity-row__text">status</span>
                                    </div>
                                    <div class="activity-row__meta">
                                        <span>Boolean</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Content (2/3) - Data Summary and Quality -->
                    <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                        <!-- Column Title -->
                        <h2 class="heading-2" id="column-title" style="padding-bottom: 0;">user_id</h2>
                        
                        <!-- Detected Issues Banner with Title -->
                        <div class="banner style-variant-secondary">
                            <div class="icon-container icon-small">
                                <i class="fas fa-info-circle" style="color: var(--secondary-blue-600);"></i>
                            </div>
                            <div class="content">
                                <div class="title body-text-medium">Column Insights</div>
                                <div class="text body-text">Outliers in <strong>user_id</strong> column (5 values), missing values in multiple columns (563 records)</div>
                            </div>
                        </div>
                        
                        <!-- Properties -->
                        <div class="card bg-white">
                            <h2 class="card__title heading-4">Properties</h2>
                            <div class="card__content">
                                <div class="grid grid-cols-2" style="gap: var(--space-4)">
                                    <!-- Column Type Card -->
                                    <div class="overview-card overview-card--grey">
                                        <div class="overview-card__header">
                                            <span class="overview-card__title">Column Type</span>
                                        </div>
                                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.columnType}</div>
                                        <div class="overview-card__subtitle" style="font-weight: 400;">Data type of column</div>
                                    </div>
                                    
                                    <!-- Distinct Values Card -->
                                    <div class="overview-card overview-card--grey">
                                        <div class="overview-card__header">
                                            <span class="overview-card__title">Distinct Values</span>
                                        </div>
                                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.distinct}</div>
                                        <div class="overview-card__subtitle" style="font-weight: 400;">Unique values count</div>
                                    </div>
                                    
                                    <!-- Duplicate Values Card -->
                                    <div class="overview-card overview-card--grey">
                                        <div class="overview-card__header">
                                            <span class="overview-card__title">Duplicate Values</span>
                                        </div>
                                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.duplicates}</div>
                                        <div class="overview-card__subtitle" style="font-weight: 400;">Number of duplicated values</div>
                                    </div>
                                    
                                    <!-- Missing Values Card -->
                                    <div class="overview-card overview-card--grey">
                                        <div class="overview-card__header">
                                            <span class="overview-card__title">Missing Values</span>
                                        </div>
                                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.missing}</div>
                                        <div class="overview-card__subtitle" style="font-weight: 400;">Count of null values</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sample Values Card -->
                        <div class="card bg-white">
                            <h2 class="card__title heading-4">Sample Values</h2>
                            <div class="card__content">
                                <span class="body-text" style="font-weight: 400;">24, 32, 27, 45, 36, 19, 27, 34, 52, 34</span>
                            </div>
                        </div>
                        
                        <!-- Outliers Card -->
                        <div class="card bg-white">
                            <h2 class="card__title heading-4">Outliers</h2>
                            <div class="card__content">
                                <span class="body-text" style="font-weight: 400;">18, 62, 63, 64, 65</span>
                            </div>
                        </div>

                        <!-- Statistics Card -->
                        <div class="card bg-white">
                            <h2 class="card__title heading-4">Statistics</h2>
                            <div class="card__content"></div>
                        </div>
                        
                        <!-- Distinct Values Card -->
                        <div class="card bg-white">
                            <h2 class="card__title heading-4">Distinct Values</h2>
                            <div class="card__content">
                                <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                                    <div class="grid grid-cols-2" style="gap: var(--space-4)">
                                        <!-- Distinct Count Card -->
                                        <div class="overview-card overview-card--grey">
                                            <div class="overview-card__header">
                                                <span class="overview-card__title">Distinct Count</span>
                                    </div>
                                            <div class="overview-card__value" style="font-weight: 400;">${data.properties.distinct}</div>
                                            <div class="overview-card__subtitle" style="font-weight: 400;">Unique values in column</div>
                                    </div>
                                        
                                        <!-- Uniqueness Card -->
                                        <div class="overview-card overview-card--grey">
                                            <div class="overview-card__header">
                                                <span class="overview-card__title">Uniqueness</span>
                                    </div>
                                            <div class="overview-card__value" style="font-weight: 400;">${((data.properties.distinct / 12458) * 100).toFixed(1)}%</div>
                                            <div class="overview-card__subtitle" style="font-weight: 400;">Percentage of unique values</div>
                            </div>
                        </div>
                        
                                    <!-- Top 5 Values section with chart -->
                                    <div style="margin-top: var(--space-2);">
                                        <h3 class="body-text-medium" style="margin-bottom: var(--space-3); color: var(--neutral-grey-800);">Top 5 Values</h3>
                                        
                                        <div style="height: 200px;">
                                            <canvas id="topValuesChart"></canvas>
                            </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Column data mapping (sample data for each column)
        const columnData = {
            'user_id': {
                properties: {
                    columnType: 'Integer',
                    distinct: 12458,
                    duplicates: 0,
                    missing: 0
                },
                sampleValues: '10001, 10002, 10003, 10004, 10005, 10006, 10007, 10008, 10009, 10010',
                outliers: '20455, 20456, 20457, 20458, 20459',
                statistics: {
                    mean: 15229,
                    median: 15230,
                    min: 10001,
                    max: 20458
                },
                qualityMetrics: {
                    completeness: 100.0,
                    validity: 100.0,
                    consistency: 100.0,
                    accuracy: 100.0
                },
                rangeFrequency: {
                    range: '10001-20458',
                    chartData: [2491, 2492, 2491, 2492, 2492]
                }
            },
            'email': {
                properties: {
                    columnType: 'String',
                    distinct: 12245,
                    duplicates: 213,
                    missing: 124
                },
                sampleValues: 'john.doe@company.com, alice.smith@email.net, robert.jones@domain.org, sarah.wilson@mail.com',
                outliers: 'N/A (non-numeric data)',
                statistics: {
                    mean: 'N/A (non-numeric data)',
                    median: 'N/A (non-numeric data)',
                    min: 'N/A',
                    max: 'N/A'
                },
                qualityMetrics: {
                    completeness: 99.0,
                    validity: 98.2,
                    consistency: 97.1,
                    accuracy: 96.5
                },
                rangeFrequency: {
                    range: 'N/A (string data)',
                    chartData: [1224, 3674, 4898, 1837, 612]
                }
            },
            'name': {
                properties: {
                    columnType: 'String',
                    distinct: 11245,
                    duplicates: 1213,
                    missing: 89
                },
                sampleValues: 'John Smith, Alice Johnson, Robert Wilson, Sarah Davis, Michael Brown',
                outliers: 'N/A (non-numeric data)',
                statistics: {
                    mean: 'N/A (non-numeric data)',
                    median: 'N/A (non-numeric data)',
                    min: 'N/A',
                    max: 'N/A'
                },
                qualityMetrics: {
                    completeness: 99.3,
                    validity: 99.8,
                    consistency: 94.2,
                    accuracy: 95.6
                },
                rangeFrequency: {
                    range: 'N/A (string data)',
                    chartData: [2249, 3374, 4122, 1837, 787]
                }
            },
            'age': {
                properties: {
                    columnType: 'Integer',
                    distinct: 82,
                    duplicates: 12376,
                    missing: 156
                },
                sampleValues: '25, 31, 42, 28, 35, 47, 39, 33, 51, 29',
                outliers: '14, 15, 92, 95, 97',
                statistics: {
                    mean: 38,
                    median: 35,
                    min: 14,
                    max: 97
                },
                qualityMetrics: {
                    completeness: 98.7,
                    validity: 99.1,
                    consistency: 95.8,
                    accuracy: 94.7
                },
                rangeFrequency: {
                    range: '14-97',
                    chartData: [624, 4983, 4858, 1837, 156]
                }
            },
            'signup_date': {
                properties: {
                    columnType: 'Date',
                    distinct: 892,
                    duplicates: 11566,
                    missing: 279
                },
                sampleValues: '2024-02-15, 2024-02-14, 2024-02-13, 2024-02-12, 2024-02-11',
                outliers: '2020-01-12, 2020-02-23',
                statistics: {
                    mean: '2022-08-15',
                    median: '2023-06-23',
                    min: '2020-01-12',
                    max: '2024-02-15'
                },
                qualityMetrics: {
                    completeness: 97.8,
                    validity: 99.9,
                    consistency: 93.2,
                    accuracy: 96.1
                },
                rangeFrequency: {
                    range: '2020-2024',
                    chartData: [623, 1245, 2491, 3736, 4363]
                }
            },
            'status': {
                properties: {
                    columnType: 'Boolean',
                    distinct: 2,
                    duplicates: 12456,
                    missing: 53
                },
                sampleValues: 'true, false, true, true, false',
                outliers: 'N/A (boolean data)',
                statistics: {
                    mean: '0.82 (82% true)',
                    median: 'N/A (boolean data)',
                    min: 'false',
                    max: 'true'
                },
                qualityMetrics: {
                    completeness: 99.6,
                    validity: 100.0,
                    consistency: 100.0,
                    accuracy: 99.5
                },
                rangeFrequency: {
                    range: 'Boolean',
                    chartData: [82, 18, 0, 0, 0]
                }
            }
        };

        // Helper function to format numbers with spaces between thousands
        function formatNumber(number) {
            if (number === undefined || number === null) return '';
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }

        // Function to create a column view template
        function createColumnViewTemplate(columnName, data) {
            return `
                <h2 class="heading-2" id="column-title" style="padding-bottom: 0;">${columnName}</h2>
                
                <div class="banner style-variant-secondary">
                    <div class="icon-container icon-small">
                        <i class="fas fa-info-circle" style="color: var(--secondary-blue-600);"></i>
                    </div>
                    <div class="content">
                        <div class="title body-text-medium">Column Insights</div>
                        <div class="text body-text"></div>
                    </div>
                </div>
                
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Properties</h2>
                    <div class="card__content">
                        <div class="grid grid-cols-2" style="gap: var(--space-4)">
                            <!-- Column Type Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Column Type</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${data ? data.properties.columnType : ''}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Data type of column</div>
                            </div>
                            
                            <!-- Distinct Values Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Distinct Values</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${data ? formatNumber(data.properties.distinct) : ''}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Unique values count</div>
                            </div>
                            
                            <!-- Duplicate Values Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Duplicate Values</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${data ? formatNumber(data.properties.duplicates) : ''}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Number of duplicated values</div>
                            </div>
                            
                            <!-- Missing Values Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Missing Values</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${data ? formatNumber(data.properties.missing) : ''}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Count of null values</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Sample Values</h2>
                    <div class="card__content"></div>
                </div>
                
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Outliers</h2>
                    <div class="card__content"></div>
                </div>

                <div class="card bg-white">
                    <h2 class="card__title heading-4">Statistics</h2>
                    <div class="card__content"></div>
                </div>
                
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Distinct Values</h2>
                    <div class="card__content">
                        <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                            <div class="grid grid-cols-2" style="gap: var(--space-4)">
                                <!-- Distinct Count Card -->
                                <div class="overview-card overview-card--grey">
                                    <div class="overview-card__header">
                                        <span class="overview-card__title">Distinct Count</span>
                                    </div>
                                    <div class="overview-card__value" style="font-weight: 400;">${data ? formatNumber(data.properties.distinct) : ''}</div>
                                    <div class="overview-card__subtitle" style="font-weight: 400;">Unique values in column</div>
                                </div>
                                
                                <!-- Uniqueness Card -->
                                <div class="overview-card overview-card--grey">
                                    <div class="overview-card__header">
                                        <span class="overview-card__title">Uniqueness</span>
                                    </div>
                                    <div class="overview-card__value" style="font-weight: 400;">${data ? ((data.properties.distinct / 12458) * 100).toFixed(1) : ''}%</div>
                                    <div class="overview-card__subtitle" style="font-weight: 400;">Percentage of unique values</div>
                                </div>
                            </div>
                            
                            <!-- Top 5 Values section with chart -->
                            <div style="margin-top: var(--space-2);">
                                <h3 class="body-text-medium" style="margin-bottom: var(--space-3); color: var(--neutral-grey-800);">Top 5 Values</h3>
                                
                                <div style="height: 200px;">
                                    <canvas id="topValuesChart-${columnName}"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to create table overview template
        function createTableOverviewTemplate(titleElement) {
            const titleHtml = titleElement ? titleElement.outerHTML : '<h2 class="heading-2" id="column-title" style="padding-bottom: 0;">Table Overview</h2>';
            
            return `
                ${titleHtml}
                
                <!-- Data Summary Card -->
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Data Summary</h2>
                    <div class="card__content">
                        <div class="grid grid-cols-2" style="gap: var(--space-4)">
                            <!-- Columns Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Columns</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">6</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Total columns in table</div>
                            </div>
                            
                            <!-- Rows Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Rows</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${formatNumber(12458)}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Total records</div>
                            </div>
                            
                            <!-- Attribute Types Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Attribute Types</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">4</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">String, Integer, Date, Boolean</div>
                            </div>
                            
                            <!-- Data Size Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Data Size</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">4.8 MB</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">Total storage used</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Quality Overview -->
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Data Quality Overview</h2>
                    <div class="card__content">
                        <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Missing Cells (Nulls)</span>
                                <span class="body-text" style="font-weight: 400;">${formatNumber(648)} (5.2%)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Duplicated Records</span>
                                <span class="body-text" style="font-weight: 400;">${formatNumber(1245)} (10%)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Duplicated Rows</span>
                                <span class="body-text" style="font-weight: 400;">${formatNumber(213)} (1.7%)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profiling Metadata -->
                <div class="card bg-white">
                    <h2 class="card__title heading-4">Profiling Metadata</h2>
                    <div class="card__content">
                        <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Last Profiled</span>
                                <span class="body-text" style="font-weight: 400;">Feb 12 16:29</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Profiled by</span>
                                <div style="display: flex; align-items: center; gap: var(--space-2);">
                                    <div style="width: 24px; height: 24px; border-radius: 50%; background-color: var(--secondary-blue-600); color: white; display: flex; align-items: center; justify-content: center; font-size: 12px;">T</div>
                                    <span class="body-text" style="font-weight: 400;">Tomáš Janoušek</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to update content based on selected column
        function selectColumn(columnName, columnType, element) {
            // Update active status in column list
            const allColumns = document.querySelectorAll('.activity-row');
            allColumns.forEach(col => {
                col.classList.remove('active');
                
                // Reset icon muted state
                const icon = col.querySelector('.fas.fa-columns');
                if (icon) {
                    icon.classList.add('icon-muted');
                }
            });
            
            // Set active styles for selected column
            element.classList.add('active');
            
            // Update column icon
            const columnIcon = element.querySelector('.fas.fa-columns');
            if (columnIcon) {
                columnIcon.classList.remove('icon-muted');
            }
            
            // Get column data
            const data = columnData[columnName];
            if (!data) return;
            
            // Restore the original column view if we're coming from table overview
            const rightPanel = document.querySelector('.content-layout > div:last-child');
            if (rightPanel) {
                // Check if we're in table overview mode
                const cards = rightPanel.querySelectorAll('.card');
                if (cards.length > 0) {
                    const firstCardTitle = cards[0].querySelector('.card__title');
                    if (firstCardTitle && firstCardTitle.textContent === 'Data Summary') {
                        // We need to restore the column view structure
                        rightPanel.innerHTML = createColumnViewTemplate(columnName, data);
                    }
                }
            }
            
            // Update banner content with column name
            const bannerTitleElement = document.querySelector('.banner .title');
            const bannerTextElement = document.querySelector('.banner .text');
            
            if (bannerTitleElement && bannerTextElement) {
                bannerTitleElement.textContent = 'Column Insights';
                
                // Create appropriate insight message based on column data
                let insightMessage = '';
                
                // Check for outliers
                if (data.outliers && data.outliers !== 'N/A (non-numeric data)' && data.outliers !== 'N/A (boolean data)') {
                    const outliersList = data.outliers.split(',');
                    insightMessage += `${outliersList.length} outliers found`;
                }
                
                // Check for missing values
                if (data.properties.missing > 0) {
                    if (insightMessage) {
                        insightMessage += ', ';
                    }
                    insightMessage += `${data.properties.missing} missing values`;
                }
                
                bannerTextElement.innerHTML = insightMessage;
                
                // Show the banner only if there are insights
                const bannerElement = document.querySelector('.banner');
                if (bannerElement) {
                    if (insightMessage) {
                        bannerElement.style.display = '';
                    } else {
                        bannerElement.style.display = 'none';
                    }
                }
            }
            
            // Update column title at the top of the right panel
            const columnTitleElement = document.getElementById('column-title');
            if (columnTitleElement) {
                columnTitleElement.textContent = columnName;
            }
            
            // Use helper function to find and update elements
            function updateCardContent(cardTitleText, newContent) {
                const cardTitles = document.querySelectorAll('.card__title');
                for (let i = 0; i < cardTitles.length; i++) {
                    if (cardTitles[i].textContent.trim() === cardTitleText) {
                        const contentEl = cardTitles[i].closest('.card').querySelector('.card__content');
                        if (contentEl) {
                            contentEl.innerHTML = newContent;
                            return true;
                        }
                    }
                }
                return false;
            }
            
            // Helper function to check if a value is any form of N/A
            function isNA(value) {
                if (!value) return true;
                const naValues = ['N/A', 'N/A (boolean data)', 'N/A (non-numeric data)'];
                return naValues.includes(value);
            }
            
            // Helper function to update content for Statistics card
            function updateStatisticsCard(data) {
                const isNumericType = ['Integer', 'Float', 'Number'].includes(data.properties.columnType);
                const isStringType = ['String', 'Text', 'Varchar'].includes(data.properties.columnType);
                const isBooleanType = data.properties.columnType === 'Boolean';
                const isDateType = data.properties.columnType === 'Date';
                
                let statisticsContent = `
                    <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                `;
                
                if (isDateType) {
                    // Date-specific statistics
                    const dates = data.sampleValues.split(', ').map(d => new Date(d));
                    const validDates = dates.filter(d => !isNaN(d.getTime()));
                    
                    if (validDates.length > 0) {
                        const minDate = new Date(Math.min(...validDates));
                        const maxDate = new Date(Math.max(...validDates));
                        const range = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)); // days
                        
                        statisticsContent += `
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Earliest Date</span>
                                <span class="body-text" style="font-weight: 400;">${minDate.toLocaleDateString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Latest Date</span>
                                <span class="body-text" style="font-weight: 400;">${maxDate.toLocaleDateString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Date Range</span>
                                <span class="body-text" style="font-weight: 400;">${formatNumber(range)} days</span>
                            </div>
                        `;
                        
                        // Calculate year distribution
                        const years = validDates.map(d => d.getFullYear());
                        const uniqueYears = [...new Set(years)];
                        const yearCounts = uniqueYears.map(year => ({
                            year,
                            count: years.filter(y => y === year).length
                        }));
                        
                        if (yearCounts.length > 0) {
                            statisticsContent += `
                                <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                                    <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Year Range</span>
                                    <span class="body-text" style="font-weight: 400;">${Math.min(...uniqueYears)} - ${Math.max(...uniqueYears)}</span>
                                </div>
                            `;
                        }
                    }
                } else if (isStringType) {
                    // String-specific statistics
                    const sampleValues = data.sampleValues.split(', ');
                    const lengths = sampleValues.map(str => str.length);
                    const avgLength = Math.round(lengths.reduce((a, b) => a + b, 0) / lengths.length);
                    const minLength = Math.min(...lengths);
                    const maxLength = Math.max(...lengths);
                    
                    statisticsContent += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                            <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Average Length</span>
                            <span class="body-text" style="font-weight: 400;">${formatNumber(avgLength)} characters</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                            <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Min Length</span>
                            <span class="body-text" style="font-weight: 400;">${formatNumber(minLength)} characters</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                            <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Max Length</span>
                            <span class="body-text" style="font-weight: 400;">${formatNumber(maxLength)} characters</span>
                        </div>
                    `;
                    
                    // Get string patterns based on column content
                    let patternLabel = "Common Patterns";
                    let patternCount = "3";
                    
                    // For email specifically, count domains
                    if (columnName === 'email') {
                        const domains = sampleValues
                            .map(email => email.split('@')[1])
                            .filter(domain => domain);
                        
                        const uniqueDomains = [...new Set(domains)];
                        patternLabel = "Unique Domains";
                        patternCount = formatNumber(uniqueDomains.length);
                    } else if (columnName === 'name') {
                        // For name columns, count words
                        const wordCounts = sampleValues
                            .map(name => name.split(' ').length)
                            .filter(count => count);
                        
                        const avgWords = Math.round((wordCounts.reduce((a, b) => a + b, 0) / wordCounts.length) * 10) / 10;
                        patternLabel = "Average Words";
                        patternCount = avgWords;
                    }
                    
                    statisticsContent += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                            <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">${patternLabel}</span>
                            <span class="body-text" style="font-weight: 400;">${patternCount}</span>
                        </div>
                    `;
                } else if (isNumericType || isBooleanType) {
                    // Numeric and Boolean statistics
                    if (!isNA(data.statistics.mean)) {
                statisticsContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                        <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Mean</span>
                        <span class="body-text" style="font-weight: 400;">${isNumericType ? formatNumber(data.statistics.mean) : data.statistics.mean}</span>
                    </div>
                `;
                    }
                
                    if (!isNA(data.statistics.median)) {
                statisticsContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                        <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Median</span>
                        <span class="body-text" style="font-weight: 400;">${isNumericType ? formatNumber(data.statistics.median) : data.statistics.median}</span>
                    </div>
                `;
                    }
                
                    if (!isNA(data.statistics.min)) {
                statisticsContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                        <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Min</span>
                        <span class="body-text" style="font-weight: 400;">${isNumericType ? formatNumber(data.statistics.min) : data.statistics.min}</span>
                    </div>
                `;
                    }
                
                    if (!isNA(data.statistics.max)) {
                statisticsContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                        <span class="body-text-medium" style="color: var(--neutral-grey-500-base); font-weight: 400;">Max</span>
                        <span class="body-text" style="font-weight: 400;">${isNumericType ? formatNumber(data.statistics.max) : data.statistics.max}</span>
                    </div>
                `;
                    }
                }
                
                statisticsContent += `</div>`;
                
                // Update the Statistics card content
                updateCardContent('Statistics', statisticsContent);
            }
            
            // Helper function to update outliers
            function updateOutliersCard(data) {
                // Find all cards
                const cards = document.querySelectorAll('.card');
                let outliersCard = null;
                
                // Find the Outliers card
                cards.forEach(card => {
                    const title = card.querySelector('.card__title');
                    if (title && title.textContent.trim() === 'Outliers') {
                        outliersCard = card;
                    }
                });
                
                const isNumericType = ['Integer', 'Float', 'Number'].includes(data.properties.columnType);
                const hasOutliers = data.outliers && !isNA(data.outliers) && data.outliers !== 'N/A (boolean data)' && data.outliers !== 'N/A (non-numeric data)';
                
                // Remove the card if it exists and shouldn't be shown
                if (outliersCard && (!isNumericType || !hasOutliers)) {
                    outliersCard.parentElement.removeChild(outliersCard);
                    return;
                }
                
                // Only show outliers for numeric types with actual outliers
                if (isNumericType && hasOutliers) {
                    // Format outliers for display
                    const outlierValues = data.outliers.split(',').map(v => v.trim());
                    const formattedOutliers = outlierValues.join(', ');
                    
                    // If card doesn't exist, create it after Sample Values card
                    if (!outliersCard) {
                        const cards = document.querySelectorAll('.card');
                        let insertAfterCard = null;
                        
                        // Find Sample Values card to insert after it
                        cards.forEach(card => {
                            const title = card.querySelector('.card__title');
                            if (title && title.textContent.trim() === 'Sample Values') {
                                insertAfterCard = card;
                            }
                        });
                        
                        if (insertAfterCard) {
                            const newOutliersCard = document.createElement('div');
                            newOutliersCard.className = 'card bg-white';
                            newOutliersCard.innerHTML = `
                                <h2 class="card__title heading-4">Outliers</h2>
                                <div class="card__content">
                                    <span class="body-text" style="font-weight: 400;">${formattedOutliers}</span>
                                </div>
                            `;
                            insertAfterCard.parentElement.insertBefore(newOutliersCard, insertAfterCard.nextSibling);
                        }
                    } else {
                        // Update existing card
                        const contentDiv = outliersCard.querySelector('.card__content');
                        if (contentDiv) {
                            contentDiv.innerHTML = `
                                <span class="body-text" style="font-weight: 400;">${formattedOutliers}</span>
                            `;
                        }
                        
                        // Ensure correct position (after Sample Values)
                        const cards = document.querySelectorAll('.card');
                        let sampleValuesCard = null;
                        let outlierPos = -1;
                        let samplePos = -1;
                        
                        // Find positions of both cards
                        for (let i = 0; i < cards.length; i++) {
                            const title = cards[i].querySelector('.card__title');
                            if (title && title.textContent.trim() === 'Sample Values') {
                                sampleValuesCard = cards[i];
                                samplePos = i;
                            }
                            if (title && title.textContent.trim() === 'Outliers') {
                                outlierPos = i;
                            }
                        }
                        
                        // If found and in wrong order, move the outliers card
                        if (sampleValuesCard && outlierPos > -1 && samplePos > -1 && outlierPos !== samplePos + 1) {
                            const parent = sampleValuesCard.parentElement;
                            parent.insertBefore(outliersCard, sampleValuesCard.nextSibling);
                        }
                    }
                }
            }
            
            // Update Properties card
            updateCardContent('Properties', `
                <div class="grid grid-cols-2" style="gap: var(--space-4)">
                    <!-- Column Type Card -->
                    <div class="overview-card overview-card--grey">
                        <div class="overview-card__header">
                            <span class="overview-card__title">Column Type</span>
                        </div>
                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.columnType}</div>
                        <div class="overview-card__subtitle" style="font-weight: 400;">Data type of column</div>
                    </div>
                    
                    <!-- Distinct Values Card -->
                    <div class="overview-card overview-card--grey">
                        <div class="overview-card__header">
                            <span class="overview-card__title">Distinct Values</span>
                        </div>
                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.distinct}</div>
                        <div class="overview-card__subtitle" style="font-weight: 400;">Unique values count</div>
                    </div>
                    
                    <!-- Duplicate Values Card -->
                    <div class="overview-card overview-card--grey">
                        <div class="overview-card__header">
                            <span class="overview-card__title">Duplicate Values</span>
                        </div>
                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.duplicates}</div>
                        <div class="overview-card__subtitle" style="font-weight: 400;">Number of duplicated values</div>
                    </div>
                    
                    <!-- Missing Values Card -->
                    <div class="overview-card overview-card--grey">
                        <div class="overview-card__header">
                            <span class="overview-card__title">Missing Values</span>
                        </div>
                        <div class="overview-card__value" style="font-weight: 400;">${data.properties.missing}</div>
                        <div class="overview-card__subtitle" style="font-weight: 400;">Count of null values</div>
                    </div>
                </div>
            `);
            
            // Update Sample Values card
            if (data.properties.columnType === 'Boolean') {
                // Hide Sample Values card for boolean columns
                const sampleValuesCards = document.querySelectorAll('.card');
                sampleValuesCards.forEach(card => {
                    const title = card.querySelector('.card__title');
                    if (title && title.textContent.trim() === 'Sample Values') {
                        card.style.display = 'none';
                    }
                });
            } else {
                // Show and update Sample Values for non-boolean columns
                updateCardContent('Sample Values', `
                    <span class="body-text" style="font-weight: 400;">${data.sampleValues}</span>
                `);
            }
            
            // Call updateOutliersCard to properly handle the Outliers card
            updateOutliersCard(data);
            
            // Update Statistics card
            updateStatisticsCard(data);
            
            // Update Quality Metrics
            updateQualityMetrics(data.qualityMetrics);
            
            // Remove existing Distinct Values card if it exists
            const existingDistinctCards = document.querySelectorAll('.card');
            existingDistinctCards.forEach(card => {
                const title = card.querySelector('.card__title');
                if (title && title.textContent.trim() === 'Distinct Values') {
                    card.parentElement.removeChild(card);
                }
            });
            
            // Update Distinct Values visualization
            const distinctValuesCard = document.createElement('div');
            distinctValuesCard.className = 'card bg-white';
            
            // Special handling for Boolean type
            const isBooleanType = data.properties.columnType === 'Boolean';
            const totalRecords = 12458;
            const distinctCount = data.properties.distinct;
            const uniquenessPercentage = ((distinctCount / totalRecords) * 100).toFixed(1);
            
            // For Boolean type, calculate true/false distribution
            let trueCount = 0;
            let falseCount = 0;
            if (isBooleanType) {
                trueCount = Math.round(totalRecords * 0.82); // 82% true from the mean
                falseCount = totalRecords - trueCount - data.properties.missing;
            }
            
            distinctValuesCard.innerHTML = `
                <h2 class="card__title heading-4">Distinct Values</h2>
                <div class="card__content">
                    <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                        <div class="grid grid-cols-2" style="gap: var(--space-4)">
                            <!-- Distinct Count Card -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">Distinct Count</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${distinctCount}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">${isBooleanType ? 'true/false values' : 'Unique values in column'}</div>
                            </div>
                            
                            <!-- Distribution Card for Boolean -->
                            <div class="overview-card overview-card--grey">
                                <div class="overview-card__header">
                                    <span class="overview-card__title">${isBooleanType ? 'Distribution' : 'Uniqueness'}</span>
                                </div>
                                <div class="overview-card__value" style="font-weight: 400;">${isBooleanType ? '82% true' : uniquenessPercentage + '%'}</div>
                                <div class="overview-card__subtitle" style="font-weight: 400;">${isBooleanType ? 'Percentage of true values' : 'Percentage of unique values'}</div>
                            </div>
                        </div>
                        
                        <!-- Value Distribution section -->
                        <div style="margin-top: var(--space-2);">
                            <h3 class="body-text-medium" style="margin-bottom: var(--space-3); color: var(--neutral-grey-800);">
                                ${isBooleanType ? 'Value Distribution' : 'Top 5 Values'}
                            </h3>
                            <div style="height: 200px; position: relative;">
                                <canvas id="topValuesChart-${columnName}"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Find the Statistics card and insert the Distinct Values card after it
            const statisticsCards = document.querySelectorAll('.card');
            let insertAfterCard = null;
            
            statisticsCards.forEach(card => {
                const title = card.querySelector('.card__title');
                if (title && title.textContent.trim() === 'Statistics') {
                    insertAfterCard = card;
                }
            });
            
            if (insertAfterCard && insertAfterCard.parentElement) {
                insertAfterCard.parentElement.insertBefore(distinctValuesCard, insertAfterCard.nextSibling);
                
                // Initialize the chart after the card is inserted
                const canvasId = `topValuesChart-${columnName}`;
                const topValuesCanvas = document.getElementById(canvasId);
                
                if (topValuesCanvas) {
                    let chartConfig;
                    
                    if (isBooleanType) {
                        // Special configuration for Boolean type
                        chartConfig = {
                            type: 'bar',
                            data: {
                                labels: ['true', 'false'],
                                datasets: [{
                                    label: 'Count',
                                    data: [trueCount, falseCount],
                                    backgroundColor: [
                                        'rgba(75, 210, 110, 0.8)',
                                        'rgba(235, 87, 87, 0.8)'
                                    ],
                                    borderColor: [
                                        'rgb(75, 210, 110)',
                                        'rgb(235, 87, 87)'
                                    ],
                                    borderWidth: 1,
                                    barThickness: 40
                                }]
                            },
                            options: {
                                indexAxis: 'y',
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const percentage = ((context.raw / totalRecords) * 100).toFixed(1);
                                                return `${context.raw} records (${percentage}%)`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        beginAtZero: true,
                                        grid: {
                                            display: false
                                        },
                                        ticks: {
                                            font: {
                                                family: 'Inter'
                                            }
                                        }
                                    },
                                    y: {
                                        grid: {
                                            color: 'rgba(217, 221, 229, 0.5)'
                                        },
                                        ticks: {
                                            font: {
                                                family: 'Inter'
                                            }
                                        }
                                    }
                                }
                            }
                        };
                    } else {
                        // Original configuration for non-Boolean types
                        const sampleValues = data.sampleValues.split(', ').slice(0, 5);
                        let occurrences;
                        
                        if (columnName === 'age') {
                            occurrences = [3245, 4121, 2987, 1567, 538];
                        } else if (columnName === 'signup_date') {
                            occurrences = [2456, 3123, 3567, 2234, 1078];
                        } else {
                            occurrences = [4876, 3342, 2287, 1215, 738];
                        }
                        
                        chartConfig = {
                            type: 'bar',
                            data: {
                                labels: sampleValues,
                                datasets: [{
                                    label: 'Occurrences',
                                    data: occurrences,
                                    backgroundColor: 'rgba(31, 143, 255, 0.8)',
                                    borderColor: 'rgb(31, 143, 255)',
                                    borderWidth: 1,
                                    barThickness: 20
                                }]
                            },
                            options: {
                                indexAxis: 'y',
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.raw} occurrences`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        beginAtZero: true,
                                        grid: {
                                            display: false
                                        },
                                        ticks: {
                                            font: {
                                                family: 'Inter'
                                            }
                                        }
                                    },
                                    y: {
                                        grid: {
                                            color: 'rgba(217, 221, 229, 0.5)'
                                        },
                                        ticks: {
                                            font: {
                                                family: 'Inter'
                                            }
                                        }
                                    }
                                }
                            }
                        };
                    }
                    
                    // Create new chart
                    new Chart(topValuesCanvas, chartConfig);
                }
            }
            
            // Update URL with column parameter to enable bookmarking and sharing
            const url = new URL(window.location.href);
            url.searchParams.set('column', columnName);
            history.pushState({column: columnName}, '', url);
        }
        
        // Helper function to update quality metrics
        function updateQualityMetrics(metrics) {
            // Find the Data Quality Metrics card
            const cardTitles = document.querySelectorAll('.card__title');
            let qualityMetricsCard = null;
            
            for (let i = 0; i < cardTitles.length; i++) {
                if (cardTitles[i].textContent.trim() === 'Data Quality Metrics') {
                    qualityMetricsCard = cardTitles[i].closest('.card');
                    break;
                }
            }
            
            if (!qualityMetricsCard) return;
            
            // Get the grid container for metrics
            const gridContainer = qualityMetricsCard.querySelector('.card__content > div');
            if (!gridContainer) return;
            
            // Get the left and right columns
            const columns = gridContainer.querySelectorAll('div');
            if (columns.length < 2) return;
            
            // Update Completeness (first metric in left column)
            const completenessContainer = columns[0].querySelector('div:first-child');
            if (completenessContainer) {
                const completenessLabel = completenessContainer.querySelector('.body-text-medium');
                if (completenessLabel) {
                    completenessLabel.innerHTML = `
                        <span style="color: var(--neutral-grey-500-base); font-weight: 400;">Completeness</span>
                        <span>${metrics.completeness}%</span>
                    `;
                    
                    const progressBarContainer = completenessContainer.querySelector('div:last-child');
                    if (progressBarContainer) {
                        const progressBar = progressBarContainer.querySelector('div');
                        if (progressBar) {
                            progressBar.style.width = `${metrics.completeness}%`;
                            progressBar.style.backgroundColor = metrics.completeness < 90 ? 
                                'var(--warning-orange-500-base)' : 'var(--success-green-500-base)';
                        }
                    }
                }
            }
            
            // Update Validity (second metric in left column)
            const validityContainer = columns[0].querySelector('div:nth-child(2)');
            if (validityContainer) {
                const validityLabel = validityContainer.querySelector('.body-text-medium');
                if (validityLabel) {
                    validityLabel.innerHTML = `
                        <span style="color: var(--neutral-grey-500-base); font-weight: 400;">Validity</span>
                        <span>${metrics.validity}%</span>
                    `;
                    
                    const progressBarContainer = validityContainer.querySelector('div:last-child');
                    if (progressBarContainer) {
                        const progressBar = progressBarContainer.querySelector('div');
                        if (progressBar) {
                            progressBar.style.width = `${metrics.validity}%`;
                            progressBar.style.backgroundColor = metrics.validity < 90 ? 
                                'var(--warning-orange-500-base)' : 'var(--success-green-500-base)';
                        }
                    }
                }
            }
            
            // Update Consistency (first metric in right column)
            const consistencyContainer = columns[1].querySelector('div:first-child');
            if (consistencyContainer) {
                const consistencyLabel = consistencyContainer.querySelector('.body-text-medium');
                if (consistencyLabel) {
                    consistencyLabel.innerHTML = `
                        <span style="color: var(--neutral-grey-500-base); font-weight: 400;">Consistency</span>
                        <span>${metrics.consistency}%</span>
                    `;
                    
                    const progressBarContainer = consistencyContainer.querySelector('div:last-child');
                    if (progressBarContainer) {
                        const progressBar = progressBarContainer.querySelector('div');
                        if (progressBar) {
                            progressBar.style.width = `${metrics.consistency}%`;
                            progressBar.style.backgroundColor = metrics.consistency < 90 ? 
                                'var(--warning-orange-500-base)' : 'var(--success-green-500-base)';
                        }
                    }
                }
            }
            
            // Update Accuracy (second metric in right column)
            const accuracyContainer = columns[1].querySelector('div:nth-child(2)');
            if (accuracyContainer) {
                const accuracyLabel = accuracyContainer.querySelector('.body-text-medium');
                if (accuracyLabel) {
                    accuracyLabel.innerHTML = `
                        <span style="color: var(--neutral-grey-500-base); font-weight: 400;">Accuracy</span>
                        <span>${metrics.accuracy}%</span>
                    `;
                    
                    const progressBarContainer = accuracyContainer.querySelector('div:last-child');
                    if (progressBarContainer) {
                        const progressBar = progressBarContainer.querySelector('div');
                        if (progressBar) {
                            progressBar.style.width = `${metrics.accuracy}%`;
                            progressBar.style.backgroundColor = metrics.accuracy < 90 ? 
                                'var(--warning-orange-500-base)' : 'var(--success-green-500-base)';
                        }
                    }
                }
            }
        }
        
        // Function to display table overview
        function selectTableOverview(element) {
            // Update active status in column list
            const allColumns = document.querySelectorAll('.activity-row');
            allColumns.forEach(col => {
                col.classList.remove('active');
                
                // Reset icon muted state
                const icon = col.querySelector('.fas.fa-columns');
                if (icon) {
                    icon.classList.add('icon-muted');
                }
            });
            
            // Set active styles for selected element
            element.classList.add('active');
            
            // Update icon appearance
            const tableIcon = element.querySelector('.fas.fa-table');
            if (tableIcon) {
                tableIcon.classList.remove('icon-muted');
            }
            
            // Update column title at the top of the right panel
            const columnTitleElement = document.getElementById('column-title');
            if (columnTitleElement) {
                columnTitleElement.textContent = 'Table Overview';
            }
            
            // Remove the warning banner when viewing table overview
            const bannerElement = document.querySelector('.banner');
            if (bannerElement) {
                bannerElement.style.display = 'none';
            }
            
            // Create and display overview cards
            const rightPanel = document.querySelector('.content-layout > div:last-child');
            if (rightPanel) {
                // Save the original column title
                const originalTitle = rightPanel.querySelector('#column-title');
                rightPanel.innerHTML = createTableOverviewTemplate(originalTitle);
            }
            
            // Update URL with tableOverview parameter to enable bookmarking and sharing
            const url = new URL(window.location.href);
            url.searchParams.delete('column');
            url.searchParams.set('view', 'table-overview');
            history.pushState({view: 'table-overview'}, '', url);
        }
        
        // On DOMContentLoaded event handler
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function for querySelector with contains
            Element.prototype.contains = function(text) {
                return (this.textContent || this.innerText).indexOf(text) > -1;
            };
            
            // Check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const viewParam = urlParams.get('view');
            const columnParam = urlParams.get('column');
            
            if (viewParam === 'table-overview') {
                // Find and select the table overview element
                const tableOverviewElement = document.querySelector('.activity-row:first-child');
                if (tableOverviewElement) {
                    selectTableOverview(tableOverviewElement);
                }
            } else if (columnParam && columnData[columnParam]) {
                // Find column element
                let targetElement = null;
                
                document.querySelectorAll('.activity-row').forEach(element => {
                    const columnNameElement = element.querySelector('.activity-row__text');
                    if (columnNameElement && columnNameElement.textContent === columnParam) {
                        targetElement = element;
                    }
                });
                
                if (targetElement) {
                    // Get column type
                    const columnTypeElement = targetElement.querySelector('.activity-row__meta span');
                    const columnType = columnTypeElement ? columnTypeElement.textContent : '';
                    
                    // Select column
                    selectColumn(columnParam, columnType, targetElement);
                } else {
                    // Default to user_id if column not found
                    selectDefaultColumn();
                }
            } else {
                // If no parameters specified, default to table overview
                const tableOverviewElement = document.querySelector('.activity-row:first-child');
                if (tableOverviewElement) {
                    selectTableOverview(tableOverviewElement);
                }
            }
            
            // Function to select default column (user_id)
            function selectDefaultColumn() {
                let targetElement = null;
                
                document.querySelectorAll('.activity-row').forEach(element => {
                    const columnNameElement = element.querySelector('.activity-row__text');
                    if (columnNameElement && columnNameElement.textContent === 'user_id') {
                        targetElement = element;
                        
                        // Skip the Table Overview element
                        const tableIcon = element.querySelector('.fas.fa-table');
                        if (tableIcon) return;
                        
                        const columnTypeElement = element.querySelector('.activity-row__meta span');
                        const columnType = columnTypeElement ? columnTypeElement.textContent : '';
                        
                        selectColumn('user_id', columnType, element);
                    }
                });
            }
            
            // Handle tab switching for main navigation tabs
            const mainTabItems = document.querySelectorAll('.content-wrapper > .tabs .tab-item');
            
            mainTabItems.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    mainTabItems.forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                });
            });
        });
    </script>
</body>
</html> 